{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MlakuMlaku{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="{% static 'css/geist.css' %}">
    <style>
        @font-face {
            font-family: 'Geist';
            src: url('{% static "font/geist/Geist-Medium.ttf" %}') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #1a202c; /* Dark background */
            font-family: 'Geist', sans-serif;
        }
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .quote {
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
        }
        .modal-content {
            max-height: 80vh; /* Set max height for modal content */
            overflow-y: auto; /* Enable vertical scroll */
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="bg-gray-800 p-4">
        <div class="container mx-auto flex justify-between">
            <a href="#" class="text-white font-bold text-xl">MlakuMlaku</a>
            <div>
                <a href="#itinerary" class="text-white px-4">Itinerary</a>
                <a href="#" class="text-white px-4">Journal</a>
                <a href="#" class="text-white px-4">Collection</a>
                <button class="ml-4 bg-gray-600 text-white px-4 py-2 rounded">Sign up</button>
                <button class="ml-2 bg-gray-600 text-white px-4 py-2 rounded">Log in</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero text-center">
        <h1 class="text-5xl font-bold mb-4">{% block hero_title %}Itinerary{% endblock %}</h1>
        <blockquote class="quote italic text-lg">
            {% block hero_quote %}
            "Where exploring shared travel plans sparks <span class="text-red-500">inspiration</span>, and setting your dream journey becomes <span class="text-red-500">effortless</span>."
            {% endblock %}
        </blockquote>
        <button id="plan-tour" class="bg-blue-600 text-white px-6 py-3 rounded-full">Plan your tour</button>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto py-8">
        {% block content %} 
        <!-- Content goes here -->
        {% endblock %}
    </div>

    <!-- Modal for Planning Tour -->
    <div id="tour-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded shadow-lg w-96 relative">
            <button id="close-modal" class="absolute top-2 right-2 text-gray-600 hover:text-gray-800 text-3xl">&times;</button>
            <h2 class="text-xl font-semibold mb-4">Create Your Itinerary</h2>
            <div class="modal-content">
                <form id="itinerary-form">
                    <label class="block mb-2">Itinerary Name:</label>
                    <input type="text" id="itinerary-name" class="border p-2 w-full mb-4" required>
                
                    <label class="block mb-2">Cover Image:</label>
                    <input type="file" id="itinerary-cover" class="border p-2 w-full mb-4" accept="image/*">
                
                    <div id="days-container"></div>
                
                    <button type="button" id="add-day" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">Add Day</button>
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Create Itinerary</button>
                    <!-- Tambahkan tombol Confirm Editing di sini -->
                    <button type="button" id="confirm-editing" class="bg-yellow-500 text-white px-4 py-2 rounded ml-2 hidden">Confirm Editing</button>
                </form>                
            </div>
        </div>
    </div>

    <div class="container mx-auto py-8">
        <!-- This is where we will append the created itinerary cards -->
        <div id="itinerary-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <script>
        const planTourButton = document.getElementById('plan-tour');
        const tourModal = document.getElementById('tour-modal');
        const closeModalButton = document.getElementById('close-modal');
        const addDayButton = document.getElementById('add-day');
        const daysContainer = document.getElementById('days-container');
        let dayCount = 1;
        let editingCard = null;
    
        // Show modal when "Plan Tour" button is clicked
        planTourButton.onclick = function () {
            tourModal.classList.toggle('hidden');
            clearForm();
        };
    
        // Close modal when "X" button is clicked
        closeModalButton.onclick = function () {
            tourModal.classList.add('hidden');
            clearForm();
        };
    
        function clearForm() {
            document.getElementById('itinerary-name').value = '';
            document.getElementById('itinerary-cover').value = '';
            daysContainer.innerHTML = '';
            dayCount = 1;
            editingCard = null;
        }
    
        // Add day input fields
        addDayButton.onclick = function () {
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('mb-4');
            dayDiv.innerHTML = `
                <h3 class="font-semibold mb-2">Day ${dayCount}</h3>
                <div class="destinations-container mb-2">
                    <label class="block mb-1">Destination:</label>
                    <input type="text" class="border p-2 w-full mb-1" required>
                    <label class="block mb-1">Date:</label>
                    <input type="date" class="border p-2 w-full mb-1" required>
                    <label class="block mb-1">Time:</label>
                    <input type="time" class="border p-2 w-full mb-2" required>
                </div>
                <button type="button" class="bg-blue-600 text-white px-2 py-1 rounded add-destination">Add Destination at the Same Day</button>
            `;
    
            // Add destination event listener
            dayDiv.querySelector('.add-destination').onclick = function () {
                const destinationDiv = document.createElement('div');
                destinationDiv.classList.add('destinations-container', 'mb-2');
                destinationDiv.innerHTML = `
                    <label class="block mb-1">Destination:</label>
                    <input type="text" class="border p-2 w-full mb-1" required>
                    <label class="block mb-1">Time:</label>
                    <input type="time" class="border p-2 w-full mb-2" required>
                `;
                dayDiv.appendChild(destinationDiv);
                dayDiv.appendChild(this);
            };
    
            daysContainer.appendChild(dayDiv);
            dayCount++;
        };
    
        // Form submission handler
        document.getElementById('itinerary-form').onsubmit = function (e) {
            e.preventDefault();
            
            const itineraryName = document.getElementById('itinerary-name').value;
            const itineraryCover = document.getElementById('itinerary-cover').files[0];
            const reader = new FileReader();
            
            // Collect day details dynamically
            const daysData = [];
            const dayContainers = document.querySelectorAll('#days-container > div');
            dayContainers.forEach((dayDiv, index) => {
                const dayData = {
                    day: index + 1,
                    date: dayDiv.querySelector('input[type="date"]').value,
                    destinations: []
                };
    
                const destinationInputs = dayDiv.querySelectorAll('input[type="text"]');
                const timeInputs = dayDiv.querySelectorAll('input[type="time"]');
    
                destinationInputs.forEach((input, idx) => {
                    if (input.value) {
                        dayData.destinations.push({
                            destination: input.value,
                            time: timeInputs[idx] ? timeInputs[idx].value : ''
                        });
                    }
                });
    
                daysData.push(dayData);
            });
            
            reader.onload = function (e) {
                const coverImageUrl = e.target.result;
                
                if (editingCard) {
                    updateCard(editingCard, itineraryName, coverImageUrl, daysData);
                    editingCard = null;
                } else {
                    createCard(itineraryName, coverImageUrl, daysData);
                }
                clearForm();
            };
            
            if (itineraryCover) {
                reader.readAsDataURL(itineraryCover);
            } else if (editingCard) {
                const existingCoverImage = editingCard.querySelector('img').src;
                updateCard(editingCard, itineraryName, existingCoverImage, daysData);
                editingCard = null;
            }
        };
    
        function updateCard(card, itineraryName, coverImageUrl, daysData) {
            card.querySelector('h3').innerText = itineraryName;
            card.querySelector('img').src = coverImageUrl;
            
            const existingDaysContainer = card.querySelector('div:nth-child(2)');
            existingDaysContainer.innerHTML = '';
    
            daysData.forEach(dayData => {
                const dayItem = document.createElement('div');
                dayItem.classList.add('mb-4', 'p-4', 'border', 'border-gray-300', 'rounded-lg');
                dayItem.innerHTML = `<h4 class="text-lg font-semibold mb-2">Day ${dayData.day} - ${dayData.date}</h4>`;
                
                dayData.destinations.forEach(dest => {
                    const destItem = document.createElement('p');
                    destItem.innerHTML = `<strong>Destination:</strong> ${dest.destination} <strong>Time:</strong> ${dest.time}`;
                    dayItem.appendChild(destItem);
                });
                existingDaysContainer.appendChild(dayItem);
            });
        }
    
        function createCard(itineraryName, coverImageUrl, daysData) {
            const itineraryCard = document.createElement('div');
            itineraryCard.classList.add('bg-white', 'rounded-lg', 'shadow-lg', 'p-6');
            
            itineraryCard.innerHTML = `
                <img src="${coverImageUrl}" alt="Cover Image" class="w-full h-48 object-cover rounded-lg mb-4">
                <h3 class="text-xl font-semibold mb-2">${itineraryName}</h3>
                <div class="flex justify-between mb-4">
                    <button class="bg-yellow-500 text-white px-4 py-2 rounded edit-button">Edit</button>
                    <button class="bg-red-500 text-white px-4 py-2 rounded delete-button">Delete</button>
                </div>
            `;
    
            const daysContainer = document.createElement('div');
            daysData.forEach(dayData => {
                const dayItem = document.createElement('div');
                dayItem.classList.add('mb-4', 'p-4', 'border', 'border-gray-300', 'rounded-lg');
                dayItem.innerHTML = `<h4 class="text-lg font-semibold mb-2">Day ${dayData.day} - ${dayData.date}</h4>`;
    
                dayData.destinations.forEach(dest => {
                    const destItem = document.createElement('p');
                    destItem.innerHTML = `<strong>Destination:</strong> ${dest.destination} <strong>Time:</strong> ${dest.time}`;
                    dayItem.appendChild(destItem);
                });
                daysContainer.appendChild(dayItem);
            });
            
            itineraryCard.appendChild(daysContainer);
            document.getElementById('itinerary-cards').appendChild(itineraryCard);
    
            itineraryCard.querySelector('.edit-button').onclick = function () {
                document.getElementById('itinerary-name').value = itineraryName;
                clearDaysContainer();
                daysData.forEach(dayData => {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('mb-4');
                    dayDiv.innerHTML = `
                        <h3 class="font-semibold mb-2">Day ${dayData.day}</h3>
                        <div class="destinations-container mb-2">
                            <label class="block mb-1">Destination:</label>
                            <input type="text" class="border p-2 w-full mb-1" value="${dayData.destinations[0].destination}" required>
                            <label class="block mb-1">Date:</label>
                            <input type="date" class="border p-2 w-full mb-1" value="${dayData.date}" required>
                            <label class="block mb-1">Time:</label>
                            <input type="time" class="border p-2 w-full mb-2" value="${dayData.destinations[0].time}" required>
                        </div>
                    `;
                    daysContainer.appendChild(dayDiv);
                });
                editingCard = itineraryCard;
                document.getElementById('confirm-editing').classList.remove('hidden');
                document.getElementById('confirm-editing').onclick = function () {
                    document.getElementById('itinerary-form').dispatchEvent(new Event('submit'));
                    document.getElementById('confirm-editing').classList.add('hidden');
                };
                tourModal.classList.toggle('hidden');
            };
    
            itineraryCard.querySelector('.delete-button').onclick = function () {
                itineraryCard.remove();
            };
        }
    
        function clearDaysContainer() {
            daysContainer.innerHTML = '';
            dayCount = 1;
        }
    </script>
         

</body>
</html>
